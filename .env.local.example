# Adventorator Local Development Environment (.env.local)
#
# Copy this file to ".env.local" and fill in values for your environment.
# This file demonstrates all supported settings. Unset items fall back to
# config.toml defaults. Environment variables override config.toml.
#
# Notes:
# - Booleans accept true/false (case-insensitive)
# - Integers accept plain numbers
# - For nested config (ask_kb, retrieval) use double underscores: SECTION__FIELD

########################################
# Discord App Credentials (Required)
########################################
DISCORD_APP_ID=replace-with-application-id            # Developer Portal → General Information → Application ID
DISCORD_PUBLIC_KEY=replace-with-public-key            # Developer Portal → General Information → Public Key
DISCORD_BOT_TOKEN=replace-with-bot-token             # Bot settings → Token (keep secret)
DISCORD_GUILD_ID=optional-guild-id                    # Optional: guild-scoped registration target

# Local CLI/dev overrides (Optional; for scripts/web_cli.py only)
# Set a dev public/private keypair generated by scripts/generate_keys.py
DISCORD_DEV_PUBLIC_KEY=optional-dev-public-key
DISCORD_PRIVATE_KEY=optional-dev-private-key

########################################
# Database
########################################
# Default local DB is SQLite; uncomment Postgres for local PG dev
DATABASE_URL=sqlite+aiosqlite:///./adventorator.sqlite3
# DATABASE_URL=postgresql+asyncpg://user:pass@localhost:5432/adventorator

# Convenience ports (used by app and docs/dev flows)
APP_PORT=18000
DB_PORT=5432

########################################
# Runtime Environment
########################################
ENV=dev                                            # dev|staging|prod (affects logs and timeouts)
RESPONSE_TIMEOUT_SECONDS=3                         # Discord initial response window (seconds)

########################################
# LLM Configuration
########################################
# Provider: ollama (local) or openai (OpenAI-compatible endpoint)
LLM_API_PROVIDER=ollama

# If provider=ollama, point at your Ollama instance (default macOS install):
LLM_API_URL=http://localhost:11434                  # Base URL; client normalizes to /api/chat

# If provider=openai, point at a v1-compatible API (base URL only):
# LLM_API_URL=https://api.openai.com                # Client appends /v1 as needed
# LLM_API_KEY=replace-with-api-key

# Model and prompting
LLM_MODEL_NAME=llama3:8b                           # Example: llama3:8b, gemma3:4b-it-q8_0, dolphin-mistral:7b
LLM_DEFAULT_SYSTEM_PROMPT="You are a helpful assistant."
LLM_MAX_PROMPT_TOKENS=4096                         # Soft cap used for transcript trimming
LLM_MAX_RESPONSE_CHARS=4096                        # Safety cap for preview parsing

########################################
# Feature Flags (safe-by-default; enable what you want)
########################################
FEATURES_LLM=true                                  # Master toggle for LLM features
FEATURES_LLM_VISIBLE=true                          # Show narration to channel (false = shadow mode)
FEATURE_PLANNER_ENABLED=true                       # Hard enable/disable planner
FEATURES_RULES=true                                # Internal rules helpers
FEATURES_COMBAT=true                               # Enable attack preview path
FEATURES_ACTION_VALIDATION=true                    # Generate Plan and validate
FEATURES_PREDICATE_GATE=true                       # Guard planned actions by scene/actor
FEATURES_MCP=false                                 # MCP integrations (future)
FEATURES_ACTIVITY_LOG=true                         # Write activity logs
FEATURES_PLANNING_TIERS=true                       # Tiered planner scaffolding
FEATURES_MAP=false                                 # Experimental map features
FEATURES_EVENTS=false                              # Persistent event ledger (disabled by default)
FEATURES_EXECUTOR=true                             # Use executor for previews when available
FEATURES_EXECUTOR_CONFIRM=true                     # Require /confirm for pending actions

# Improbability Drive (/ask) and NLU sub-flags
FEATURES_IMPROBABILITY_DRIVE=true
FEATURES_ASK=true
FEATURES_ASK_NLU_RULE_BASED=true
FEATURES_ASK_KB_LOOKUP=false
FEATURES_ASK_PLANNER_HANDOFF=false
FEATURES_ASK_NLU_DEBUG=false

########################################
# Planner Controls
########################################
PLANNER_TIMEOUT_SECONDS=20                         # Seconds to wait for planner model
PLANNER_MAX_LEVEL=1                                # 1 = single-step plan

########################################
# Retrieval (Phase 6)
########################################
# Nested config via double underscores
RETRIEVAL__ENABLED=false                           # true to enable retrieval augmentation
RETRIEVAL__PROVIDER=none                           # none|pgvector|qdrant
RETRIEVAL__TOP_K=4                                 # top-k snippets to include

########################################
# /ask Knowledge Base (Phase 3)
########################################
ASK_KB__TIMEOUT_S=0.05
ASK_KB__MAX_CANDIDATES=5
ASK_KB__CACHE_TTL_S=60
ASK_KB__CACHE_MAX_SIZE=1024
ASK_KB__MAX_TERMS_PER_CALL=20

########################################
# Logging
########################################
LOGGING_ENABLED=true
LOGGING_LEVEL=DEBUG                                # Overall root filter level
LOGGING_CONSOLE=INFO                               # Per-handler level (INFO|DEBUG|WARNING|ERROR|CRITICAL|NONE)
LOGGING_FILE=DEBUG
LOGGING_TO_CONSOLE=true
LOGGING_TO_FILE=true
LOGGING_FILE_PATH=logs/adventorator.jsonl
LOGGING_MAX_BYTES=5000000
LOGGING_BACKUP_COUNT=5

########################################
# Ops
########################################
METRICS_ENDPOINT_ENABLED=true                      # Enable /metrics (Prometheus format)

########################################
# Discord Webhook Override (Dev only)
########################################
# Redirects follow-ups to local sink (used by web_cli.py flows)
# DISCORD_WEBHOOK_URL_OVERRIDE=http://localhost:18000/dev-webhook

########################################
# Dev Tweaks (advanced)
########################################
# Bypass certain caches in CLI/testing contexts
# WEB_CLI_RAW_MODE=true
# Copy this file to .env.local and fill in the values before running the app.
# See README.md and docs/implementation_plan.md for setup instructions.
DISCORD_APP_ID=replace-with-application-id           # Developer Portal → General Information → Application ID
DISCORD_PUBLIC_KEY=replace-with-public-key           # Developer Portal → General Information → Public Key
DISCORD_DEV_PUBLIC_KEY=optional-dev-public-key       # Used only for local web_cli.py requests; keep DISCORD_PUBLIC_KEY set to the real Discord key
DISCORD_BOT_TOKEN=replace-with-bot-token             # Bot settings → Token (keep secret)
DISCORD_GUILD_ID=optional-guild-id                   # Optional for guild-scoped registration
DATABASE_URL=sqlite+aiosqlite:///./adventorator.sqlite3
# Example for Postgres (uncomment and adjust):
# DATABASE_URL=postgresql+asyncpg://user:pass@localhost:5432/adventorator
FEATURES_LLM=true
FEATURES_LLM_VISIBLE=true
LLM_API_PROVIDER="openai"                                # LLM API provider (ollama, openai)
LLM_API_URL=http://localhost:11434                       # LLM API URL, will auto apply endpoint path (/v1/chat/completions, /api/chat, etc)
LLM_API_KEY="replace-with-api-key"                       # API key for OpenAI-compatible services (keep secret)
LLM_MODEL_NAME=llama3:8b
LLM_DEFAULT_SYSTEM_PROMPT="You are a helpful assistant."
ENV=dev

POSTGRES_USER=adventorator
POSTGRES_PASSWORD=adventorator
POSTGRES_DB=adventorator
DB_PORT=5432
APP_PORT=18000

# For development/testing with local Web CLI only; do NOT use in production!
# Generate a local keypair for CLI-signed requests. Set DISCORD_DEV_PUBLIC_KEY to the "public" value
# and DISCORD_PRIVATE_KEY to the "private" value from scripts/generate_keys.py. Leave DISCORD_PUBLIC_KEY
# pointing at your real Discord app key so Discord-originated requests continue to verify.
#DISCORD_DEV_PUBLIC_KEY=0
#DISCORD_PRIVATE_KEY=0